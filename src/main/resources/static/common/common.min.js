
$(document).ready(function() {

/*------------------When We Click Question Mark----------------------------*/
	
$('#searchpropDet').click(function() {
	 if  ($('#ulbIdDesc').val() != 0) 
	 {
 		$('#frmData').attr('action',searchPropertyDet);
 		$("#frmData").submit();
	 }
 		else
	{
		 $('#ulbIdDesc').focus().select().css('border-color', 'red');
        alert("Please Select ULB Name");
	 }
 	});


$("#searchWaterDet").click(function() {
	 if  ($('#ulbIdDesc').val() != 0) 
	 {
	 $('#frmData').attr('action', searchWaterDet);
	$("#frmData").submit();
	 }
	 else
		 {
		 $('#ulbIdDesc').focus().select().css('border-color', 'red');
       alert("Please Select ULB Name");
		 }
});

$("#searchLicenDet").click(function() {
	 if  ($('#ulbIdDesc').val() != 0) 
	 {
		 
	 $('#frmData').attr('action', searchLicenDet);
	 $("#frmData").submit();
	 }
	 else
		 {
		 $('#ulbIdDesc').focus().select().css('border-color', 'red');
        alert("Please Select ULB Name");
		 }
});


/*$('#licNo').on('blur', function() {
	
	$('#frmData').attr('action', searchLicenDet);
	 $("#frmData").submit();

});*/
/*------------------When We Click Search Button Start----------------------------*/


/*$("#waterSearch").click(function() {
	  waterSearch();
});*/


/*$("#propertySearch1").click(function() {

	searchProperty();
});*/


$("#savData").click(function() {
 	payProperty();
 });

$("#saveNocData").click(function() {
	if(submitApplicantValidations() && validateCheckList()) 
	{	
	
	saveNocServiceData();
	
	}
 });

/*$("#genReport").click(function() {
	getNocReportData();
 })*/


/*----------For Print acknoledgement slip-----------------------*/

function ackView()
{
	 $('#ackFrm').attr('action', ackUrl);
	 $("#ackFrm").submit();
}

function removeEmptyValueFromJSON(reqArr){
    for(var key in reqArr) {
        if (reqArr[key] == undefined || reqArr[key] == '') {
            delete reqArr[key];
        }
        for(var inKey in reqArr[key]) {
            if (reqArr[key][inKey] == undefined || reqArr[key][inKey] == '') {
                delete reqArr[key][inKey];
            }
        }
    }
    return reqArr;
}


/*-----------------------Save Applicant details common-----------------------  */
$('#licNo').on('blur', function() {
	
	if($("#licNo").val() != "")
	{

	 $('#frmData').attr('action', jsonResultUrl);
	 $("#frmData").submit();
	}
});


function payProperty()
{
	
	var datavar = $("#frmData").serializeObject();
	 console.log(" >>> datavar <<< "+datavar);
	var json_string = JSON.stringify(datavar);
	 console.log(" >>> json_string <<< "+json_string);
	 var datavar = removeEmptyValueFromJSON(json_string);
	 console.log(" >>> datavar <<< "+datavar);
	
	
	$.ajax({
		type : "POST",
		url : sendNoDuePayProperty,
		contentType: "application/json; charset=UTF-8",
		dataType : 'json',
		data : datavar,
		async : false,
		success : function(data2) 
		{
			
			if(data2.totalRows != 0){
			
			
			
			$('#srnIdAck').val(data2.srn_id);
		    console.log("VAL: "+data2.serviceId);
			 new PNotify({
					title : 'Service Data Saved Suceesfully',
					styling : 'bootstrap3',
					type : 'success'
				});
			}
			else
				{
				 new PNotify({
						title : 'Data not Saved',
						styling : 'bootstrap3',
						type : 'error'
					});
		}
		}
	
	});
	
	
}	


function saveNocServiceData()
{
	
	payProperty();
	
	/*$("#frmData").serializeObject();*/
	var datavar = {
			"propertyNo" : $("#propertyNo").val(),
			"propAdress" : $("#propAdress").val(),
			"propusage" : $("#usage").val(),
			//"buildingType" : $("#buildingType").val(),
			//"tmCmLookupDetHierarchicalByLookupDetHierId1ConsClass" : $("#tmCmLookupDetHierarchicalByLookupDetHierId1ConsClass").val(),
			"plotNo" : $("#plotNo").val(),
			"ctsNo" : $("#ctsNo").val(),
			"connectionNo" : $("#waterConnNo").val(),
			"licenseNo" : $("#licNo").val(),
			"buildingPermisionPropsalNo" : $("#buildingPermisionPropsalNo").val(),
			"occupencyCertificateNo" : $("#occupencyCertificateNo").val(),
			"lookupDetIdBusinessType" : $("#businessType").val(),
			"businessDescription" : $("#businessDescription").val(),
			//"licensceType" : $("#licenType").val(),
			
			
	}
	/* console.log(" >>> datavar <<< "+datavar);
	var json_string = JSON.stringify(datavar);
	 console.log(" >>> json_string <<< "+json_string);
	var datavar = removeEmptyValueFromJSON(json_string);
*/	 chklist = 
	console.log(" >>> datavar <<< "+datavar);
	
	$.ajax({
		type : "POST",
		url :JSONsaveNocServiceData,
		contentType: "application/json; charset=UTF-8",
		dataType : 'json',
		data : JSON.stringify(datavar),
		async : false,
		success : function(data2) 
		{
			
			if(data2.totalRows != 0){
			new PNotify({
                   title: 'Save successfully Data',
                   styling: 'bootstrap3',
                   type: 'success'
               });
			
			 commonChecklist();
			
			 
			}
			else
				{
				new PNotify({
	                   title: 'Data not Saved',
	                   styling: 'bootstrap3',
	                   type: 'error'
	               });
				
				
				}//window.location.href = data;
		}
	
	});
	
	
	}	




function saveNocServiceData1()
{
	payProperty();
	
	/*$("#frmData").serializeObject();*/
	var datavar = {
			"propertyNo" : $("#propertyNo").val(),
			"propAdress" : $("#propAdress").val(),
			"propusage" : $("#usage").val(),
			//"buildingType" : $("#buildingType").val(),
			//"tmCmLookupDetHierarchicalByLookupDetHierId1ConsClass" : $("#tmCmLookupDetHierarchicalByLookupDetHierId1ConsClass").val(),
			"plotNo" : $("#plotNo").val(),
			"ctsNo" : $("#ctsNo").val(),
			"connectionNo" : $("#waterConnNo").val(),
			"licenseNo" : $("#licNo").val(),
			"buildingPermisionPropsalNo" : $("#buildingPermisionPropsalNo").val(),
			"occupencyCertificateNo" : $("#occupencyCertificateNo").val(),
			"lookupDetIdBusinessType" : $("#businessType").val(),
			"businessDescription" : $("#businessDescription").val(),
			
			
	}
	/* console.log(" >>> datavar <<< "+datavar);
	var json_string = JSON.stringify(datavar);
	 console.log(" >>> json_string <<< "+json_string);
	var datavar = removeEmptyValueFromJSON(json_string);
*/	 
	console.log(" >>> datavar <<< "+datavar);
	
	$.ajax({
		type : "POST",
		url :JSONsaveNocServiceData,
		contentType: "application/json; charset=UTF-8",
		dataType : 'json',
		data : JSON.stringify(datavar),
		async : false,
		success : function(data2) 
		{
			
			if(data2.totalRows != 0){
			new PNotify({
                   title: 'Applicant Data Saved successfully',
                   styling: 'bootstrap3',
                   type: 'success'
               });
			
			
			 
			}
			else
				{
				new PNotify({
	                   title: 'Data not Saved',
	                   styling: 'bootstrap3',
	                   type: 'error'
	               });
				
				
				}//window.location.href = data;
		}
	
	});
	
	
	}	
//water search Button
$('#waterConnNo').on('blur', function() {

	var ulbId = $("#ulbIdDesc").val().split("|");
	console.log("ulbId "+ulbId[0]);
	
	if($("#waterConnNo").val() != "")
	{
		    $("#firstwaterdiv").show();
		    $("#secondwaterdiv").show();
		    $("#payDuewater").show();
		    $("#payDueAmt").show();
		    $("#waterLabelId").show();
		var datavar = {"connectionNo":$("#waterConnNo").val(),"ulbId":ulbId[0]} ;
		 console.log("jsonsearchWaterUrl"+jsonsearchWaterUrl)
		 
		$.ajax({
			type : "POST",
			url : jsonsearchWaterUrl,
			contentType: "application/json; charset=UTF-8",
			dataType : 'json',
			data : JSON.stringify(datavar),
			success : function(data) 
			{
				
				if(data.totalRows != 0){
				
	   	          $("#waterDiv").show();	
			      console.log("VAL: "+data.totalRows);
				 
	   	          var row = 1;
	   	          var name=null;
	   	          var OldPropNO= null;
	   	          dataSet = [];
	   	          
	   	          console.log("data.resultData[0].connectionId--"+data.resultData[0].connectionNo);
	   	          
	   	         name=(data.resultData[0].firstownername)+' '+(data.resultData[0].middleownername)+' '+(data.resultData[0].lastownername);
	   	         var fname=data.resultData[0].firstownername;
	   	         var mname=data.resultData[0].middleownername;
	   	         var lname=data.resultData[0].firstownername;
	   	         var ownaddress= data.resultData[0].ownerAddress;
	   	      
	   	   
	   	         OldPropNO= (data.resultData[0].connectionNoOld)
	   	          
	   	    	if(data.resultData[0].connectionNo == "00000")
	   	    	{
	   	    		$("#waterConnectionId").val(data.resultData[0].connectionId);
	   	    		
	   	    	        console.log(" if cond ");   
	   	    	        
		   	       		var datavar = {"ulbIdDesc":$("#ulbIdDesc").val() ,"setServiceId":$("#setServiceId").val()} ;
		   	       		console.log("jsonsearchWaterChargesUrl"+jsonsearchWaterChargesUrl)  
		   	       		
		   	        $.ajax({
		   	       		
		   	 			type : "POST",
		   	 			url : jsonsearchWaterChargesUrl,
		   	 			contentType: "application/json; charset=UTF-8",
		   	 			dataType : 'json',
		   	 			data : JSON.stringify(datavar),
		   	 			
		   	 			success : function(data1) {
		   	 				
		   	 			 console.log("VAL: "+data1.totalRows);
						 
			   	          var row = 1;
			   	          dataSet = [];
			   	          if(parseInt(data1.totalRows) > 0) {
			   	       	   var newArray = [];
			   	       	   var totCol = 0;
			   	       	   $.each(data1.resultData, function (i, result1) {
		   	 			
				   	    	var ConNo=$("#connectionNo").val();
							
				   	    	$("#spropOldCno").val(OldPropNO);
							$("#payDueAmt").val(0);
							//$("#spropName").val(name);
							$("#spropName").val(fname);
				   	    	$("#spropMname").val(mname);
				   	    	$("#spropLname").val(lname);
				   	    	$("#ownerAdress").val(ownerAddress);
							$('#payAmt').val(result1.charges_amt);
							$('#taxId').val(result1.service_tax_id);            //hidden field in nodue_water jsp
							$('#taxDetId').val(result1.service_tex_det_id);      //hidden field in nodue_water jsp
							$("#emailId").val(result1.emailId);
							 $('#waterConnNo').prop('disabled', true);
							 $('#spropULB').prop('disabled', true);
							 $('#searchWaterDet').prop('disabled', true);
							 $('#waterSearch').prop('disabled', true);
							 $("#payDuewater").hide();
							 
		   	 		        });
			   	            
			   	          }
			   	       else
			   	       {
			   	    	$("#spropULB").hide();
			   	    	$("#payDueAmt").val(0);
			   	    	$("#paySubmit").hide();
			   	    	$("#spropName").val(fname);
			   	    	$("#spropMname").val(mname);
			   	    	$("#spropLname").val(lname);
			   	    	$("#ownerAdress").val( data.resultData[0].ownerAddress);
			   	       // $("#charges-details").show();
			   	        $("#payDuewater").hide();
			   	    	
			   	     var newArray = [];
		   	       	   var totCol = 0;
		   	                new PNotify({
		   	                    title: 'No Water Service Charge',
		   	                    styling: 'bootstrap3',
		   	                    type: 'error'
		   	                });
		   	           }
							 
		   	 			}
		   	 	    });  //ajax ends
		   	       		   
		   	       	  
	   	    	}  //if end
	   	    	
	   	    	else 
	   	    	{
	   	    	
	   	          var newArray = [];
	   	       	   var totCol = 0;
	   	       	   
	   	       	   $.each(data.resultData, function (i, result) {
	   	       	   console.log("nameeeee---->> "+result.firstName);
	   	       	   
					$("#spropName").val(result.firstName+" "+result.middleName+" "+result.lastName);
					$("#spropULB").val(result.ulbId);
					$("#payDueAmt").val(result.current_bal);
					$("#spropName").val(result.firstownername);
		   	    	$("#spropMname").val(result.middleownername);
		   	    	$("#spropLname").val(result.lastownername);
		   	    	$("#ownerAdress").val(result.ownerAddress);
//					alert(result.propertyId);
					$("#waterConnectionId").val(result.connectionId);
					$("#emailId").val(result.emailId);
						   	         	
					 $('#waterConnNo').prop('disabled', true);
					 $('#spropULB').prop('disabled', true);
					 $('#spropName').prop('disabled', true);
					 $("#paySubmit").show();
					 $("#payDuewater").show();
					// $("#charges-details").show();
					 $("#saveNocData").hide();
					 
					 
	   	           });
	   	            
	   	         } //else
	   	         
			} 
		   else
		     {
			   $("#firstwaterdiv").hide();
			    $("#secondwaterdiv").hide();
			    $("#payDuewater").hide();
			    $("#payDueAmt").hide();
				new PNotify({
					title : 'Data No Found',
					styling : 'bootstrap3',
					type : 'error'
				});
			}
				
				
			} //success
		});
	}
	else
	{
		 new PNotify({
				title : 'Kindly Enter Water No.',
				styling : 'bootstrap3',
				type : 'error'
			});
	}
});

var usage="0";


$('#propertyNo').on('blur', function() {

	if($("#propertyNo").val() != "")
	{
		    $("#firstpropdiv").show();
		    $("#secondpropdiv").show();
		    $("#thirdpropdiv").show();
		    $("#fourthpropdiv").show();
		    $("#payDueProp").show();
		    $("#proppayDueAmt").show();
		   
		   
		    
		    
		var ulbId = $("#ulbIdDesc").val().split("|");
		
		var datavar = {"propertyNo":$("#propertyNo").val(),"ulb_id":ulbId[0]};
		
		$.ajax({
			type : "POST",
			url : jsonKnowPropertyType,                                                    
			contentType: "application/json; charset=UTF-8",
			dataType : 'json',
			data : JSON.stringify(datavar),
			async : false,
			success : function(data) {
				
				 
		   	   
				 console.log("VAL for cheking: "+data.totalRows);
				 
	   	          var row = 1;
	   	          dataSet = [];
	   	          if(parseInt(data.totalRows) > 0){
	   	       	   var newArray = [];
	   	       	   var totCol = 0;
	   	       	   
	   	       	var usage= data.resultData[0].tmCmLookupDetHierarchicalByLookupDetHierId1PropUsage.lookupDetHierId;
	   	        var subUsage= data.resultData[0].tmCmLookupDetHierarchicalByLookupDetHierId2PropUsage.lookupDetHierId ;
	   	        var lookupval=data.resultData[0].tmCmLookupDetByLookupDetIdBillType.lookupDetValue;
	   	        var  usageDetails=data.resultData[0].tmCmLookupDetHierarchicalByLookupDetHierId1PropUsage.lookupDetHierDescEn;
	   	        var  buildingType=data.resultData[0].tmCmLookupDetHierarchicalByLookupDetHierId1PropType.lookupDetHierDescEn;
	   	        var  consClass=data.resultData[0].tmCmLookupDetHierarchicalByLookupDetHierId2PropType.lookupDetHierDescEn;

	   	        
              $('#usage').val(data.resultData[0].tmCmLookupDetHierarchicalByLookupDetHierId1PropUsage.lookupDetHierId);
              $('#subUsage').val(data.resultData[0].tmCmLookupDetHierarchicalByLookupDetHierId2PropUsage.lookupDetHierId);
    		  $('#lookupval').val(data.resultData[0].tmCmLookupDetByLookupDetIdBillType.lookupDetValue);
    		  $('#usageDetails').val(data.resultData[0].tmCmLookupDetHierarchicalByLookupDetHierId1PropUsage.lookupDetHierDescEn);
    		  $('#buildingType').val(data.resultData[0].tmCmLookupDetHierarchicalByLookupDetHierId1PropType.lookupDetHierDescEn);
    		  $('#consClass').val(data.resultData[0].tmCmLookupDetHierarchicalByLookupDetHierId1PropType.lookupDetHierDescEn);
    		  
    		 // usage=$('#usage').val();
	   	       $('#propertyId').val(data.resultData[0].propertyId);
	   	     
	   	       	$.each(data.resultData, function (i, result) {
	   	       	
	   	       		 if(result.tmCmLookupDetByLookupDetIdBillType.lookupDetValue == 'W' )
	   	       		   {
	   	       			 
	   	         	$('#propertyId').val(result.propertyId);	   // propertyId Set
	   	       	
	       	       console.log("usage data  "+usage+"subUsagedata7 "+subUsage );
	       	    
	   	       		var datavar = {"propertyId":result.propertyId,"ulb_id":ulbId[0],"flatId":0};	 
	   	       		$.ajax({
	   	 			type : "POST",
	   	 			url : jsonDuesForPropertyOnType,                                                   
	   	 			contentType: "application/json; charset=UTF-8",
	   	 			dataType : 'json',
	   	 			data : JSON.stringify(datavar),
	   	 			async : false,
	   	 			success : function(data) 
	   	 			{ 
		   	 			 
			   	 console.log("data.resultData[0].property no--"+data.resultData[0].propertyNo);
			   	          
			   	    	if(data.resultData[0].propertyNo == "00000")
			   	    	{
			   	    		
			   	    	       var datavar = {"ulb_id":ulbId[0] ,"serviceId":$("#setServiceId").val(),"usage":usage,"subusage":subUsage} ;
				   	       	   console.log("jsonsearchPropertyChargesUrl"+jsonsearchPropertyChargesUrl)  
				   	       		
				   	        $.ajax({
				   	       		
				   	 			type : "POST",
				   	 			url : jsonsearchPropertyChargesUrl,  // BillDetailsDto
				   	 			contentType: "application/json; charset=UTF-8",
				   	 			dataType : 'json',
				   	 			data : JSON.stringify(datavar),
				   	 			
				   	 			success : function(data1) { 
				   	 				
				   	 				//$("#payAmt").val(data1.resultData[0].chargesAmt);
				   	 				//$("#chargeId").val(data1.resultData[0].chargeId);
				   	 			    $("#proppayDueAmt").val(0);
				   	 			    //$("#charges-details").show();
				   	 			    $("#payDueProp").hide();
				   	 				
				   	 			} 
				   	        
				   	        }); 
			   	    	        
			   	    	        
			   	    	 } //if
			   	    	
			   	    	else // when service nahi hai 
			   	    	{
			   	    		
			   	    		$("#proppayDueAmt").val(data.resultData[0].current_bal);
		   	    		   $("#firstName").val(data.resultData[0].fname);
				   	    	$("#middleName").val(data.resultData[0].mname);
				   	    	$("#lastName").val(data.resultData[0].lname);
				   	    	$("#propAdress").val(data.resultData[0].address);
				   	    	$("#plotNo").val(data.resultData[0].plotNo);
				   	    	$("#ctsNo").val(data.resultData[0].ctsNo);
				   	    	$("#propusage").val(data.resultData[0].tmCmLookupDetHierarchicalByLookupDetHierId1PropUsage);
				   	    	$("#buildingType").val(data.resultData[0].tmCmLookupDetByLookupDetIdLandType);
				   	        $("#tmCmLookupDetHierarchicalByLookupDetHierId1ConsClass").val(data.resultData[0].tmCmLookupDetHierarchicalByLookupDetHierId1PropType);
//			   	    		$("#paySubmitProp").show();
				   	       //$("#charges-details").hide();
			   	    		$("#payDueProp").show();
			   	    	    $("#propLabelId").show();
			   	    		
			   	    		
			   	    	}
	   	 			
	   	 			
	   	        	}   //success jsonDuesForPropertyOnType
	   	       		
	   	       		});
	   	       			/*---------------Code for when dues !==0 */
	   	       			 
	   	          
   	              //$("#proppayDueAmt").val(0);
	   	       	   $("#firstName").val(result.asseseeFnameRg);
	   	       	   $("#middleName").val(result.asseseeMnameRg);
	   	           $("#lastName").val(result.asseseeLnameRg);
	   	           $("#propAdress").val(result.propertyFullAddress);
	   	           $("#plotNo").val(result.plotNo);
	   	    	   $("#ctsNo").val(result.citySurveyNo);
	   	    	   //$("#propusage").val(result.tmCmLookupDetHierarchicalByLookupDetHierId1PropUsage);
	   	    	   $("#propusage").val(usageDetails);
	   	    	   $("#buildingType").val(buildingType);
	   	    	   $("#tmCmLookupDetHierarchicalByLookupDetHierId1ConsClass").val(consClass);
	   	           $("#spropOldPno").val(result.propertyOldNo);
	   	           $("#propertyId").val(result.propertyId);
	   	           $('#propertyNo').prop('disabled', true);
	   	           $("#payDueProp").show();
	   	          $("#propLabelId").show();
	   	         //  $("#charges-details").show();
	   	           $('#flatDiv').hide();
	   	       
	   	       		   
	   	       	}    //if for type 'W'
	   	       		 
	   	       		   else
	   	       		   {
	   	       			   
	   	       			   $('#flatDiv').show();
	   	       			  $("#payDueProp").hide();
   	       		          $("#proppayDueAmt").hide();
   	       		         $("#propLabelId").hide();
	   	       			   //$('#flatwiseDiv').hide();
	   	       			   var datavarFlat = {"propertyId":$('#propertyId').val(),"ulb_id":ulbId[0]};
	   	       			
	   	       			   	$.ajax({
			   	 			type : "POST",
			   	 			url : jsonsearchFlatOnPropertyNo,
			   	 			contentType: "application/json; charset=UTF-8",
			   	 			dataType : 'json',
			   	 			data : JSON.stringify(datavarFlat),
			   	 			
			   	 			success : function(data) {
			   	 				
			   	 			 var row = 1;
					          dataSet = [];
					          if(parseInt(data.totalRows) > 0){
					       	   var newArray = [];
					       	   var totCol = 0;
					       	   $.each(data.resultData, function (i, result) {
					       		   $("#flat_no").append($("<option></option>").val(result[0]).html(result[1]));
					            
					       		
					       	   });
					       	 
						       	
						       	   
					       	   
					          }else{
					                new PNotify({
					                    title: 'Data Not Found flate.',
					                    styling: 'bootstrap3',
					                    type: 'error'
					                });
					          }
			   	 				
			   	 				
			   	 			}
	   	       			
	   	       			}) 
	   	       		   }
	   	       		   
	   	       		   
	   	       		   
	   	            });   //each
	   	            
	   	          }       //if
	   	          else
	   	          {
	   	        	$("#firstpropdiv").hide();
	   			    $("#secondpropdiv").hide();
	   			    $("#thirdpropdiv").hide();
	   			    $("#fourthpropdiv").hide();
	   			    $("#payDueProp").hide();
	 		        $("#proppayDueAmt").hide();
	   	                new PNotify({
	   	                    title: 'Kindly Enter Property No.',
	   	                    styling: 'bootstrap3',
	   	                    type: 'error'
	   	                });
	   	          }
	   	          
			}    //success
		});   //ajax
	}
	/*else
	{
		 new PNotify({
				title : 'Kindly Enter Property No.',
				styling : 'bootstrap3',
				type : 'error'
			});
	}*/
});
/.......................flat wise..........................................//

function getDuesOrCharges()
{

		var ulbId = $("#ulbIdDesc").val().split("|");
		console.log("ulbId "+ulbId[0]);

  		var datavar = {"propertyId":$('#propertyId').val(),"ulb_id":ulbId[0],"flatId":$('#flat_no').val()};	 
  		$.ajax({
		type : "POST",
		url : jsonDuesForPropertyOnType,                                                   
		contentType: "application/json; charset=UTF-8",
		dataType : 'json',
		data : JSON.stringify(datavar),
		async : false,
		success : function(data) 
		{ 
			
			 console.log("VAL: "+data.totalRows);
		
	 		 console.log("data.resultData[0].property no--"+data.resultData[0].propertyNo);
	          
	          
	    	if(data.resultData[0].propertyNo == "0000011")
	    	{
	    		
	    	        console.log(" if cond 0000011 "); 
	    	        
	    	       var datavar = {"ulb_id":ulbId[0] ,"serviceId":$("#setServiceId").val(),"usage":$('#usage').val(),"subusage":$('#subUsage').val(),"flatId":$('#flat_no').val()} ;
   	       		console.log("jsonsearchPropertyChargesUrl"+jsonsearchPropertyChargesUrl)  
   	       		
   	        $.ajax({
   	       		
   	 			type : "POST",
   	 			url : jsonsearchPropertyChargesUrl,
   	 			contentType: "application/json; charset=UTF-8",
   	 			dataType : 'json',
   	 			data : JSON.stringify(datavar),
   	 			
   	 			success : function(data1) { 
   	 		     
   	 				$("#payAmt").val(data1.resultData[0].chargesAmt);
   	 				$("#chargeId").val(data1.resultData[0].chargeId);
   	 				
   	 			    $("#charges-details").show();
   	 				
   	 			} 
   	        
   	        }); 
	    	        
	    	        
	    	 } //if
	    	
	    	else 
	    	{
	    		$("#payDueAmt").val(data.resultData[0].current_bal);
	    		$("#paySubmitProp").show();
	    		$("#charges-details").show();
	    		
	    	}
		
		
		
		
   	}   //success jsonDuesForPropertyOnType
  		
  		});





}//func

var servDeschide= $("#servDeschide").val();
var amt = "0";
var nocchargeId = "0";
var nocchargedetId = "0";
$("#ulbIdDesc").change(function(){
	

		var ulbId = $("#ulbIdDesc option:selected").val();/*$(this).attr('ulbIdDesc');*/
  		var datavar = {"serviceId":servDeschide,"ulb_id":parseInt(ulbId)};	 
		
   	    console.log("jsonsearchNocChargesUrl"+jsonsearchNocChargesUrl)  
   	       		
   	        $.ajax({
   	       		
   	 			type : "POST",
   	 			url : jsonsearchNocChargesUrl,
   	 			contentType: "application/json; charset=UTF-8",
   	 			dataType : 'json',
   	 			data : JSON.stringify(datavar),
   	 			
   	 			success : function(data) { 
   	 			 $("#saveNocData").hide(); 
   	 		    $("#charges-details").show();
   	 			 var row = 1;
		          dataSet = [];
		          if(parseInt(data.totalRows) > 0){
		       	   var newArray = [];
		       	   var totCol = 0;
		       	   var charAmt=0;
		       	   $.each(data.resultData, function (i, result) {
		       		charAmt=charAmt+result.chargesAmt;
		       		 $("#payAmt").val(charAmt);
		       		 
		       		 
		       		 amt=$("#payAmt").val();
   	 				
		       		  $("#nocchargeId").val(data.resultData[0].nocchargeId);
   	 				 nocchargeId=$("#nocchargeId").val();
   	 			      $("#nocchargedetId").val(data.resultData[0].nocchargedetId);
   	 			     nocchargedetId=$("#nocchargedetId").val();
		       		
		       		
		       	   });
		       	 
			     
		          }else{
		        	  $("#charges-details").hide();
			       		 $("#saveNocData").show(); 
			       		 $("#chargeIdPay").hide();
			       		
			       		 
		                new PNotify({
		                    title: 'Data Not Available.',
		                    styling: 'bootstrap3',
		                    type: 'error'
		                });
		          }
  	 				
   	 			
   	 				
   	 			} 
   	        
   	        }); 

	});


function commonChecklist()
{
	 //$('#checkListForm').attr('action', jsonCommonChecklistUrl);
	 $("#checkListForm").submit();
}

$('#payCharges').click(function(){
	
	if(submitApplicantValidations() && validateCheckList()) 
	{	
	
		saveNocServiceData1();
	
   
	var amt = $('#payAmt').val();
	var ulbId = $("#ulbIdDesc option:selected").val();
	
	var datavar2 = {"wulbId":parseInt(ulbId),"serviceId":servDeschide,"payAmount":amt,"mobNo":$("#applicantMobile").val(),"nocchargeId":nocchargeId,"nocchargedetId":nocchargedetId,propertyId:$("#propertyId").val(),connectionId:$("#waterConnectionId").val(),propertyNo:$("#propertyNo").val(),connectionNo:$("#waterConnNo").val()};
    
    	console.log(datavar2);
    	
    	$.ajax({
    		type : "POST",
    		url : jsonpaymentgateway,
    		contentType: "application/json; charset=UTF-8",
    		 
    		data : JSON.stringify(datavar2),
    		async : false,
    		 cache: false,
    		success : function(data)
    		{
    			
    			//window.location.href = data;
    			$("#returnURL").val(data);
    		//	commonChecklist();
    			$("#checkListForm").submit();
    			
    		} ,
    		error : function(request, status, error) {
    			 //console.log("error "+request);
    			// console.log("error "+error);
    		} 
    	});
    	
	}//end
});


	$("#payDuewater").click(function()
			{
			 console.log($("#setServiceId").find(":selected").text());
			 var serviceName = $("#setServiceId").find(":selected").text();
			 var ulbId =  $("#ulbIdDesc").val().split("|");
			 var datavar2 = {"wulbId":ulbId[0],"serviceId":$("#setServiceId").val(),"payAmount":$("#payDueAmt").val(),"mobNo":"7509007566","connectionNo" :$("#connectionNo").val(),"connectionId":$("#waterConnectionId").val(),"email":"viru@gmail.com","serviceName":"water","moduleId" : "4"};
			 $.ajax({
					type : "POST",
					url : waterPayMoney,//no dues
					contentType: "application/json; charset=UTF-8",
					 
					data : JSON.stringify(datavar2),
					async : false,
					 cache: false,
					success : function(data)
					{
						window.location.href = data;
					} ,
					error : function(request, status, error) {
						 //console.log("error "+request);
						// console.log("error "+error);
					} 
				});	 
			 
			 
		 })
		 
		 
		 



$("#payDueProp").click(function()
{
	var ulbId =  $("#ulbIdDesc").val().split("|");
	 var datavarProp = {"pulbId":ulbId[0],"serviceId":$("#setServiceId").val(),"payAmountPr":$("#proppayDueAmt").val(),"mobNo":"7509007566","proptyNo" :$("#propertyNo").val(),"propertyId":$("#propertyId").val(),"email":"viru@gmail.com"};
		console.log(datavarProp);
		$.ajax({
			type : "POST",
			url : JSONPropertyPayDueMoney,//no dues
			contentType: "application/json; charset=UTF-8",
			 
			data : JSON.stringify(datavarProp),
			async : false,
			 cache: false,
			success : function(data)
			{
				window.location.href = data;
			} ,
			error : function(request, status, error) {
				 //console.log("error "+request);
				// console.log("error "+error);
			} 
		});
		       		
	});
});// ready

