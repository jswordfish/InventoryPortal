var billNo = [];
$(document).ready(function() {
	
//	$("#chargeDiv").hide();
	$("#paySubmit").hide();
	$("#paySubmitProp").hide();
	$("#flatDiv").hide();
	
	 getULBListIDnDesc(jsonULBListUrl,"ulbIdDesc");
	 getServiceList(jsonServiceListUrl,"setServiceId");
	
	 if($("#ulbIdDeschide").val() != "0")
		{
   	  		$("#ulbIdDesc").val($("#ulbIdDeschide").val());
		}
	
	 //validation
	 $("#waterSearch").click(function() {
 		  waterSearch();
	 });
	 
	 $("#propertySearch1").click(function() {
		 	searchProperty();
	 });
	 
 	 $("#paySubmit").click(function() {
		 payWaterDue();	
				 	
	 });
 	 
 	 $("#paySubmitProp").click(function() {
 		 payPropertyDue();	
 		 
 	 });
 	
 	$("#payCharges").click(function() {
 		payWaterAndPropCharges();
     });
 	
 	$("#flat_no").change(function() {
 		getDuesOrCharges();
 	});
 	 
 	//validation
 	$("#searchWaterDet").click(function() {
 		 $('#frmData').attr('action', searchWaterDet);
 		$("#frmData").submit();
	 });
 	
 	$('#searchpropDet').click(function() {
 		$('#frmData').attr('action',searchPropertyDet);
 		$("#frmData").submit();
 	});
	
 	
 	
 	  function removeEmptyValueFromJSON(reqArr){
          for(var key in reqArr) {
              if (reqArr[key] == undefined || reqArr[key] == '') {
                  delete reqArr[key];
              }
              for(var inKey in reqArr[key]) {
                  if (reqArr[key][inKey] == undefined || reqArr[key][inKey] == '') {
                      delete reqArr[key][inKey];
                  }
              }
          }
          return reqArr;
      }


/*----------------------Bill Charges Submit Starts-----------------------------*/
function payWaterAndPropCharges()
{
	console.log("in pay payWaterAndPropCharges");
	
	if(submitApplicantValidations() ) 
	 {
	
	var datavar = $("#frmData").serializeObject();
	 console.log(" >>> datavar <<< "+datavar);
	var json_string = JSON.stringify(datavar);
	 console.log(" >>> json_string <<< "+json_string);
	var datavar = removeEmptyValueFromJSON(json_string);
	 console.log(" >>> datavar <<< "+datavar);

	 
//water pay	 
 if($('#waterConnectionId').val() != null){
	
	$.ajax({
		type : "POST",
		url : sendNoDuePayProperty,
		contentType: "application/json; charset=UTF-8",
		dataType : 'json',
		data : datavar,
		async : false,
		success : function(data2) 
		{
			 console.log("VAL: "+data2.serviceId+"serviceTaxDetId---"+$('#taxDetId').val()+"taxid---"+$('#taxId').val());
			 
  	          var row = 1;
  	          dataSet = [];
  	        
  	       	   var newArray = [];
  	       	   var totCol = 0;
  	       	   
			
  	       		   var datavar2 = {"wulbId":data2.ulbId,"serviceId":data2.serviceId,"payAmount":data2.payAmt,"mobNo":data2.applicantMobile,"connectionId":$("#waterConnectionId").val(),"tax_det_id":$('#taxDetId').val(),"tax_id":$('#taxId').val(),"srn_id":$('#srnId').val()};
  	       		payChargesWater(datavar2);
		 //success
		}
	
	});
	
 }
 else
 {
//property pay	 
 $.ajax({
		type : "POST",
//		url : sendNoDuePayProperty,
		url : sendToNoChargeAckProperty,
		contentType: "application/json; charset=UTF-8",
		dataType : 'json',
		data : datavar,
		async : false,
		success : function(data2) 
		{
			 console.log("VAL: "+data2.serviceId+"chargeId---"+$('#chargeId').val());
			 
	          var row = 1;
	          dataSet = [];
	        
	       	   var newArray = [];
	       	   var totCol = 0;
	       	   
			
	       		   var datavar2 = {"ulb_id":data2.ulbId,"serviceId":data2.serviceId,"payAmount":data2.payAmt,"mobNo":data2.applicantMobile,"propertyId":$("#propertyId").val(),"chargeId":$('#chargeId').val(),"srn_id":$('#srnId').val(),"propertyNo":$('#propertyNo').val(),"serviceName":data2.serviceName,"moduleId":data2.moduleId};
	       		payChargesProperty(datavar2);
		 //success
		}
	
	}); 
	 
	}

  }//validation func
	
}//func	 



function payChargesWater(datavar2){
	console.log(datavar2);
	$.ajax({
		type : "POST",
		url : jsonpaymentgateway,
		contentType: "application/json; charset=UTF-8",
		 
		data : JSON.stringify(datavar2),
		async : false,
		 cache: false,
		success : function(data)
		{
			
			window.location.href = data;
			
		} ,
		error : function(request, status, error) {
			 //console.log("error "+request);
			// console.log("error "+error);
		} 
	});
	       		
}

function payChargesProperty(datavar2){
	console.log(datavar2);
	$.ajax({
		type : "POST",
		url : jsonpaymentgatewayProp,
		contentType: "application/json; charset=UTF-8",
		
		data : JSON.stringify(datavar2),
		async : false,
		cache: false,
		success : function(data)
		{
			console.log("data -------- "+data);
			window.location.href = data;
			
		} ,
		error : function(request, status, error) {
			console.log("error "+request);
			 console.log("error "+error);
		} 
	});
	
}

   /*----------------------Bill Charges Submit ends-----------------------------*/

   /*----------------------Bill due Submit starts-----------------------------*/
function  payWaterDue()
{
	 console.log(" inside payWaterDue ");
	
	 if(submitApplicantValidations() ) 
	 {

	 
	var datavar = $("#frmData").serializeObject();
	 console.log(" >>> datavar <<< "+datavar);
	var json_string = JSON.stringify(datavar);
	 console.log(" >>> json_string <<< "+json_string);
	var datavar = removeEmptyValueFromJSON(json_string);
	 console.log(" >>> datavar <<< "+datavar);
	
	
	$.ajax({
		type : "POST",
		url : sendNoDuePayProperty,
		contentType: "application/json; charset=UTF-8",
		dataType : 'json',
		data : datavar,
		async : false,
		success : function(data2) 
		{
			 console.log("VAL: "+data2.serviceId);
			 
  	          var row = 1;
  	          dataSet = [];
  	        
  	       	   var newArray = [];
  	       	   var totCol = 0;
  	       	
			
//  	       		   var datavar2 = {"wulbId":data2.ulbId,"serviceId":data2.serviceId,"payAmount":$("#payDueAmt").val(),"mobNo":data2.applicantMobile,"connectionNo" :$("#waterConnNo").val(),"connectionId":$("#waterConnectionId").val(),"email":$('#emailId').val()};
  	       	 var datavar2 = {"wulbId":data2.ulbId,"serviceId":data2.serviceId,"payAmount":$("#payDueAmt").val(),"mobNo":data2.applicantMobile,"connectionNo" :$("#waterConnNo").val(),"connectionId":$("#waterConnectionId").val(),"email":$('#emailId').val(),"serviceName":data2.serviceName,"moduleId":data2.moduleId };
  	       	   payDue(datavar2);
		 
		}    //success
	
	});
	
	 }//validation func
	}

	function payDue(datavar2)
	{
		console.log(datavar2);
		$.ajax({
			type : "POST",
			url : waterPayMoney,//no dues
			contentType: "application/json; charset=UTF-8",
			 
			data : JSON.stringify(datavar2),
			async : false,
			 cache: false,
			success : function(data)
			{
				window.location.href = data;
			} ,
			error : function(request, status, error) {
				 //console.log("error "+request);
				// console.log("error "+error);
			} 
		});
		       		
	}

	
	
	/*---------------------------- water due Submit End Here----------------------*/
	
	/*---------------------------- Property due Submit starts Here----------------------*/
	
	
	function  payPropertyDue()
	{
		 console.log(" inside payPropertyDue ");
		
		 if(submitApplicantValidations() ) 
		 {

		 
		var datavar = $("#frmData").serializeObject();
		 console.log(" >>> datavar <<< "+datavar);
		var json_string = JSON.stringify(datavar);
		 console.log(" >>> json_string <<< "+json_string);
		var datavar = removeEmptyValueFromJSON(json_string);
		 console.log(" >>> datavar <<< "+datavar);
		
		
		$.ajax({
			type : "POST",
			url : sendNoDuePayProperty,
			contentType: "application/json; charset=UTF-8",
			dataType : 'json',
			data : datavar,
			async : false,
			success : function(data2) 
			{
				 console.log("VAL: "+data2.serviceId);
				 
	  	          var row = 1;
	  	          dataSet = [];
	  	        
	  	       	   var newArray = [];
	  	       	   var totCol = 0;
	  	       	
				
	  	       		   var datavarProp = {"pulbId":data2.ulbId,"serviceId":data2.serviceId,"payAmountPr":$("#payDueAmt").val(),"mobNo":data2.applicantMobile,"proptyNo" :$("#propertyNo").val(),"propertyId":$("#propertyId").val(),"email":$('#emailId').val(),"serviceName":data2.serviceName,"moduleId":data2.moduleId};
	  	       		payPropDue(datavarProp);
			 
			}    //success
		
		});
		
		 }//validation func
		}
	
	function payPropDue(datavarProp)
	{
		console.log(datavarProp);
		$.ajax({
			type : "POST",
			url : JSONPropertyPayDueMoney,//no dues
			contentType: "application/json; charset=UTF-8",
			 
			data : JSON.stringify(datavarProp),
			async : false,
			 cache: false,
			success : function(data)
			{
				window.location.href = data;
			} ,
			error : function(request, status, error) {
				 //console.log("error "+request);
				// console.log("error "+error);
			} 
		});
		       		
	}

	
	
	/*---------------------------- Prop due Submit End Here----------------------*/

	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
// water search Button
function waterSearch()
{
	var ulbId = $("#ulbIdDesc").val().split("|");
	console.log("ulbId "+ulbId[0]);
	
	if($("#waterConnNo").val() != "")
	{
		var datavar = {"connectionNo":$("#waterConnNo").val(),"ulbId":ulbId[0]} ;
		 console.log("jsonsearchWaterUrl"+jsonsearchWaterUrl)
		 
		$.ajax({
			type : "POST",
			url : jsonsearchWaterUrl,
			contentType: "application/json; charset=UTF-8",
			dataType : 'json',
			data : JSON.stringify(datavar),
			success : function(data) 
			{
				
				if(data.totalRows != 0){
				
	   	          $("#waterDiv").show();	
			      console.log("VAL: "+data.totalRows);
				 
	   	          var row = 1;
	   	          var name=null;
	   	          var OldPropNO= null;
	   	          dataSet = [];
	   	          
	   	          console.log("data.resultData[0].connectionId--"+data.resultData[0].connectionNo);
	   	       $("#waterConnectionId").val(data.resultData[0].connectionId);
//	   	       alert('connId  '+data.resultData[0].connectionId) ;  
	   	         name=(data.resultData[0].firstownername)+' '+(data.resultData[0].middleownername)+' '+(data.resultData[0].lastownername);
	   	         OldPropNO= (data.resultData[0].connectionNoOld)
	   	          
	   	    	if(data.resultData[0].connectionNo == "00000")
	   	    	{
	   	    		$("#waterConnectionId").val(data.resultData[0].connectionId);
	   	    		
	   	    	        console.log(" if cond ");   
	   	    	        
		   	       		var datavar = {"ulbIdDesc":$("#ulbIdDesc").val() ,"setServiceId":$("#setServiceId").val()} ;
		   	       		console.log("jsonsearchWaterChargesUrl"+jsonsearchWaterChargesUrl)  
		   	       		
		   	        $.ajax({
		   	       		
		   	 			type : "POST",
		   	 			url : jsonsearchWaterChargesUrl,
		   	 			contentType: "application/json; charset=UTF-8",
		   	 			dataType : 'json',
		   	 			data : JSON.stringify(datavar),
		   	 			
		   	 			success : function(data1) {
		   	 				
		   	 			 console.log("VAL: "+data1.totalRows);
						 
			   	          var row = 1;
			   	          dataSet = [];
			   	          if(parseInt(data1.totalRows) > 0) {
			   	       	   var newArray = [];
			   	       	   var totCol = 0;
			   	       	   $.each(data1.resultData, function (i, result1) {
		   	 			
				   	    	var ConNo=$("#connectionNo").val();
							
				   	    	$("#spropOldCno").val(OldPropNO);
							$("#payDueAmt").val(0);
							$("#spropName").val(name);
							$('#payAmt').val(result1.charges_amt);
							$('#taxId').val(result1.service_tax_id);            //hidden field in nodue_water jsp
							$('#taxDetId').val(result1.service_tex_det_id);      //hidden field in nodue_water jsp
							$("#emailId").val(result1.emailId);
							 $('#waterConnNo').prop('disabled', true);
							 $('#spropULB').prop('disabled', true);
							 $('#searchWaterDet').prop('disabled', true);
							 $('#waterSearch').prop('disabled', true);
							 $("#chargeDiv").show();
							 $("#paySubmit").hide();
							 $("#actionbar").hide();
							 
		   	 		        });
			   	            
			   	          }
			   	       else
			   	       {
			   	    	 $("#chargeDiv").show();
			   	  	     $("#actionbar").show();
			   	    	
			   	  	     $("#spropULB").hide();
			   	    	 $("#paySubmit").hide();
			   	    	 $("#payCharges").hide();
			   	    	
			   	    	 $("#payDueAmt").val(0);
			   	    	 $("#payAmt").val(0);
			   	    	
			   	       
		   	             $('#waterSearch').prop('disabled', true);
		   	             $('#searchWaterDet').prop('disabled', true);
		   	             $('#waterConnNo').prop('disabled', true);
		   	           
		   	                new PNotify({
		   	                    title: 'No Water Service Charge',
		   	                    styling: 'bootstrap3',
		   	                    type: 'error'
		   	                });
		   	           }
							 
		   	 			}
		   	 	    });  //ajax ends
		   	       		   
		   	       	  
	   	    	}  //if end
	   	    	
	   	    	else 
	   	    	{
	   	    	
	   	          var newArray = [];
	   	       	   var totCol = 0;
	   	       	   
		   	      
	   	       	   $.each(data.resultData, function (i, result) {
	   	       	   console.log("nameeeee---->> "+result.firstName);
	   	           
	   	       	  
	   	       	   PNotify.removeAll();
		   	     	new PNotify({
						title : 'Please pay your dues first, Then you can apply for service',
						styling : 'bootstrap3',
						type : 'error'
					});
	   	       	   
					$("#spropName").val(result.firstName+" "+result.middleName+" "+result.lastName);
					$("#spropULB").val(result.ulbId);
					$("#payDueAmt").val(result.current_bal);
//					alert(result.propertyId);
					$("#waterConnectionId").val(result.connectionId);
					$("#emailId").val(result.emailId);
						   	         	
					 $('#waterConnNo').prop('disabled', true);
					 $('#searchWaterDet').prop('disabled', true);
					 $('#waterSearch').prop('disabled', true);
					 $('#spropName').prop('disabled', true);
					 $("#paySubmit").show();
					 $("#chargeDiv").hide();
					 $(".actionbar").hide();
	   	           });
	   	            
	   	         } //else
	   	         
			} 
		   else
		     {
				new PNotify({
					title : 'Data No Found',
					styling : 'bootstrap3',
					type : 'error'
				});
			}
				
				
			} //success
		});
	}
	else
	{
		 new PNotify({
				title : 'Kindly Enter Water No.',
				styling : 'bootstrap3',
				type : 'error'
			});
	}
}

//----------------------water end here--------------------------------------------------------

//----------------------Property Search- start------------------------------------------------------
 
function searchProperty()
{
	if($("#propertyNo").val() != "")
	{
		
		var ulbId = $("#ulbIdDesc").val().split("|");
		console.log("ulbId "+ulbId[0]);
		
		var datavar = {"propertyNo":$("#propertyNo").val(),"ulb_id":ulbId[0]};
//		alert("jsonKnowPropertyType url "+jsonKnowPropertyType);
		$.ajax({
			type : "POST",
			url : jsonKnowPropertyType,                                                    
			contentType: "application/json; charset=UTF-8",
			dataType : 'json',
			data : JSON.stringify(datavar),
			async : false,
			success : function(data) {
				
//				  alert("In Prop ");
		   	       $(".search-res").show();	
				 console.log("VAL: "+data.totalRows);
				 
	   	          var row = 1;
	   	          dataSet = [];
	   	          if(parseInt(data.totalRows) > 0){
	   	       	   var newArray = [];
	   	       	   var totCol = 0;
	   	       	   
	   	       	var usage= data.resultData[0].tmCmLookupDetHierarchicalByLookupDetHierId1PropUsage.lookupDetHierId;
	   	        var subUsage= data.resultData[0].tmCmLookupDetHierarchicalByLookupDetHierId2PropUsage.lookupDetHierId ;
	   	        var lookupval=data.resultData[0].tmCmLookupDetByLookupDetIdBillType.lookupDetValue;
	   	         
              $('#usage').val(data.resultData[0].tmCmLookupDetHierarchicalByLookupDetHierId1PropUsage.lookupDetHierId);
              $('#subUsage').val(data.resultData[0].tmCmLookupDetHierarchicalByLookupDetHierId2PropUsage.lookupDetHierId );
    		  $('#lookupval').val(data.resultData[0].tmCmLookupDetByLookupDetIdBillType.lookupDetValue);
	   	        
	   	        
	   	        $('#propertyId').val(data.resultData[0].propertyId);
	   	        
	   	       	   $.each(data.resultData, function (i, result) {
	   	       	
	   	       		 if(result.tmCmLookupDetByLookupDetIdBillType.lookupDetValue == 'W' )
	   	       		   {
	   	       			 
	   	       		  
//	       		var usage= result.tmCmLookupDetHierarchicalByLookupDetHierId1PropUsage.lookupDetHierId  ;
//	       	    var subUsage=result.tmCmLookupDetHierarchicalByLookupDetHierId2PropUsage.lookupDetHierId ;
	   	       	$('#propertyId').val(result.propertyId);	   // propertyId Set
	   	       	
	       	    console.log("usage  "+usage+"subUsage "+subUsage );
	       	    
	   	       		var datavar = {"propertyId":result.propertyId,"ulb_id":ulbId[0],"flatId":0};	 
	   	       		$.ajax({
	   	 			type : "POST",
	   	 			url : jsonDuesForPropertyOnType,                                                   
	   	 			contentType: "application/json; charset=UTF-8",
	   	 			dataType : 'json',
	   	 			data : JSON.stringify(datavar),
	   	 			async : false,
	   	 			success : function(data) 
	   	 			{ 
	   	 				
		   	 			 console.log("VAL: "+data.totalRows);
//		   	 		    	alert("OK");
		   	 		
			   	 		 console.log("data.resultData[0].property no--"+data.resultData[0].propertyNo);
			   	          
			   	          
			   	    	if(data.resultData[0].propertyNo == "00000")
			   	    	{
			   	    		
//			   	    		   alert("charges ahet");
			   	    	        console.log(" if cond 0000 "); 
			   	    	        
			   	    	       var datavar = {"ulb_id":ulbId[0] ,"serviceId":$("#setServiceId").val(),"usage":usage,"subusage":subUsage} ;
				   	       		console.log("jsonsearchPropertyChargesUrl"+jsonsearchPropertyChargesUrl)  
				   	       		
				   	        $.ajax({
				   	       		
				   	 			type : "POST",
				   	 			url : jsonsearchPropertyChargesUrl,
				   	 			contentType: "application/json; charset=UTF-8",
				   	 			dataType : 'json',
				   	 			data : JSON.stringify(datavar),
				   	 			
				   	 			success : function(data1) { 
				   	 		     
				   	 			 if(parseInt(data1.totalRows) > 0) 
				   	 			 {
						   	       	   var newArray = [];
						   	       	   var totCol = 0;
						   	        $.each(data1.resultData, function (i, result1) {	
						   	        	
//				   	 				alert("charges checked");
				   	 				$("#payAmt").val(result1.chargesAmt);
				   	 				$("#chargeId").val(result1.chargeId);
				   	 			    $("#payDueAmt").val(0);
				   	 			    $("#chargeDiv").show();
				   	 			    $(".actionbar").hide();
						   	        }); //each  
						   	        
				   	 			 }//if
				   	 			 else
				   	 			 {
						   	    	 $("#chargeDiv").show();
						   	  	     $(".actionbar").show();
						   	    	
//						   	  	     $("#spropULB").hide();
						   	    	 $("#paySubmitProp").hide();
						   	    	 $("#payCharges").hide();
						   	    	
						   	    	 $("#payDueAmt").val(0);
						   	    	 $("#payAmt").val(0);
						   	    	
						   	       
					   	             $('#propertySearch1').prop('disabled', true);
					   	             $('#searchpropDet').prop('disabled', true);
					   	             $('#propertyNo').prop('readonly', true);
					   	           
					   	                new PNotify({
					   	                    title: 'No Water Service Charge',
					   	                    styling: 'bootstrap3',
					   	                    type: 'success'
					   	                });
					   	           
				   	 				 
				   	 			 }//else
				   	 			    
				   	 			} //success
				   	        
				   	        }); 
			   	    	        
			   	    	        
			   	    	 } //if
			   	    	
			   	    	else 
			   	    	{
			   	    		$("#payDueAmt").val(data.resultData[0].current_bal);
			   	    		$("#paySubmitProp").show();
			   	    		$("#chargeDiv").hide();
			   	    	    $(".actionbar").hide();
//			   	    		alert("Dues ahet");
			   	    	}
	   	 			
	   	 			
	   	 			
	   	 			
	   	        	}   //success jsonDuesForPropertyOnType
	   	       		
	   	       		});
	   	       			 
	   	       			 
//	   	       alert("nameeeee"+result.asseseeMnameRg);
//	   	       alert("LookupType ###"+result.tmCmLookupDetByLookupDetIdBillType.lookupDetValue);
	   	       		
	   	       	    $("#spropName").val(result.asseseeFnameRg+"  "+result.asseseeMnameRg+"  "+result.asseseeLnameRg);
	   	         	$("#spropOldPno").val(result.propertyOldNo);
//	   	       alert("pId ---> "+result.propertyId);
	   	            $("#propertyId").val(result.propertyId);
	   	         	
	   	           $('#propertyNo').prop('readonly', true);
	   	      
	   	       		  
	   	       		   
	   	       		   
	   	       		   }    //if for type 'W'
	   	       		 
	   	       		   else
	   	       		   {
//	   	       			   alert("other ")
	   	       			   $('#flatDiv').show();
	   	       			   $('#flatwiseDiv').hide();
	   	       			   
	   	       			   var datavarFlat = {"propertyId":$('#propertyId').val(),"ulb_id":ulbId[0]};
	   	       			
	   	       			   	$.ajax({
			   	 			type : "POST",
			   	 			url : jsonsearchFlatOnPropertyNo,
			   	 			contentType: "application/json; charset=UTF-8",
			   	 			dataType : 'json',
			   	 			data : JSON.stringify(datavarFlat),
			   	 			
			   	 			success : function(data) {
			   	 				
			   	 			 var row = 1;
					          dataSet = [];
					          if(parseInt(data.totalRows) > 0){
					       	   var newArray = [];
					       	   var totCol = 0;
					       	   $.each(data.resultData, function (i, result) {
					       		   $("#flat_no").append($("<option></option>").val(result[0]).html(result[1]));
					            
					       		
					       	   });
					       	 
						       	
						       	   
					       	   
					          }else{
					                new PNotify({
					                    title: 'Data Not Found.',
					                    styling: 'bootstrap3',
					                    type: 'error'
					                });
					          }
			   	 				
			   	 				
			   	 			}
	   	       			
	   	       			}) 
	   	       		   }
	   	       		   
	   	       		   
	   	       		   
	   	            });   //each
	   	            
	   	          }       //if
	   	          else
	   	          {
	   	                new PNotify({
	   	                    title: 'Data Not Found.',
	   	                    styling: 'bootstrap3',
	   	                    type: 'error'
	   	                });
	   	          }
	   	          
			}    //success
		});   //ajax
	}
	else
	{
		 new PNotify({
				title : 'Kindly Enter Property No.',
				styling : 'bootstrap3',
				type : 'error'
			});
	}
}


//.......................flat wise..........................................//

function getDuesOrCharges()
{

		var ulbId = $("#ulbIdDesc").val().split("|");
		console.log("ulbId "+ulbId[0]);

  		var datavar = {"propertyId":$('#propertyId').val(),"ulb_id":ulbId[0],"flatId":$('#flat_no').val()};	 
  		$.ajax({
		type : "POST",
		url : jsonDuesForPropertyOnType,                                                   
		contentType: "application/json; charset=UTF-8",
		dataType : 'json',
		data : JSON.stringify(datavar),
		async : false,
		success : function(data) 
		{ 
			
			    console.log("VAL: "+data.totalRows);
//		    	alert("OK");
		
	 		 console.log("data.resultData[0].property no--"+data.resultData[0].propertyNo);
	          
	          
	    	if(data.resultData[0].propertyNo == "0000011")
	    	{
	    		
//	    		   alert("charges ahet 0000011 ## ");
	    	        console.log(" if cond 0000011 "); 
	    	        
	    	       var datavar = {"ulb_id":ulbId[0] ,"serviceId":$("#setServiceId").val(),"usage":$('#usage').val(),"subusage":$('#subUsage').val(),"flatId":$('#flat_no').val()} ;
   	       		console.log("jsonsearchPropertyChargesUrl"+jsonsearchPropertyChargesUrl)  
   	       		
   	        $.ajax({
   	       		
   	 			type : "POST",
   	 			url : jsonsearchPropertyChargesUrl,
   	 			contentType: "application/json; charset=UTF-8",
   	 			dataType : 'json',
   	 			data : JSON.stringify(datavar),
   	 			
   	 			success : function(data1) { 
   	 		     
   	 			 if(parseInt(data1.totalRows) > 0) 
   	 			 {
		   	       	   var newArray = [];
		   	       	   var totCol = 0;
		   	        $.each(data1.resultData, function (i, result1) {	
		   	        	
//   	 				alert("charges checked");
   	 				$("#payAmt").val(result1.chargesAmt);
   	 				$("#chargeId").val(result1.chargeId);
   	 			    $("#payDueAmt").val(0);
   	 			    $("#chargeDiv").show();
   	 			    $(".actionbar").hide();
		   	        }); //each  
		   	        
   	 			 }//if
   	 			 else
   	 			 {

		   	    	 $("#chargeDiv").show();
		   	  	     $(".actionbar").show();
		   	    	
//		   	  	     $("#spropULB").hide();
		   	    	 $("#paySubmitProp").hide();
		   	    	 $("#payCharges").hide();
		   	    	
		   	    	 $("#payDueAmt").val(0);
		   	    	 $("#payAmt").val(0);
		   	    	
		   	       
	   	             $('#propertySearch1').prop('disabled', true);
	   	             $('#searchpropDet').prop('disabled', true);
	   	             $('#propertyNo').prop('readonly', true);
	   	           
	   	                new PNotify({
	   	                    title: 'No Water Service Charge',
	   	                    styling: 'bootstrap3',
	   	                    type: 'success'
	   	                });
	   	           
   	 				 
   	 			  
   	 			 }//else

   	 			    
   	 			} //success
   	        
   	        }); 
	    	        
	    	        
	    	 } //if
	    	
	    	else 
	    	{
	    		$("#payDueAmt").val(data.resultData[0].current_bal);
	    		$("#paySubmitProp").show();
	    		$("#chargeDiv").hide();
	    		$(".actionbar").hide();
//	    		alert("Dues ahet");
	    	}
		
		
		
		
   	}   //success jsonDuesForPropertyOnType
  		
  		});





}//func


//waterAppln Data
$("#applicantSave").click(function() {
	
	if(submitApplicantValidations() ) 
	 {

	
	  if($('#checkServ').val() != "property") 
	  {
		 
 	 console.log(" inside Noc Certificate  ");
 	
 	var datavar = $("#frmData").serializeObject();
 	 console.log(" >>> datavar <<< "+datavar);
 	var json_string = JSON.stringify(datavar);
 	 console.log(" >>> json_string <<< "+json_string);
 	var datavar = removeEmptyValueFromJSON(json_string);
 	 console.log(" >>> datavar <<< "+datavar);
 	
 	
 	$.ajax({
 		type : "POST",
// 		url : saveApplicantDataForNoCharge,
 		url : sendToNoChargeAck,
 		contentType: "application/json; charset=UTF-8",
 		dataType : 'json',
 		data : datavar,
 		async : false,
 		success : function(data2) 
 		{ 
 
 			
 			 if(data2.serviceResp > 0)
	            {
 				 $('#srnIdNoc').val(data2.srn_id)
 				 $('#nocFrm').attr('action', nocUrl);
 				 $("#nocFrm").submit();
	            }
 			 else
 			 {
 				PNotify.removeAll();
 				new PNotify({
 					title : 'Error while saving data.',
 					styling : 'bootstrap3',
 					type : 'error'
 				});	 
 				 
 			 }
 

 } //success
 		
}); //ajax

	
	
   } //waterSubmit
  else
  {
	 
	    console.log(" inside Noc Certificate  ");
	 	
	 	var datavar = $("#frmData").serializeObject();
	 	 console.log(" >>> datavar <<< "+datavar);
	 	var json_string = JSON.stringify(datavar);
	 	 console.log(" >>> json_string <<< "+json_string);
	 	var datavar = removeEmptyValueFromJSON(json_string);
	 	 console.log(" >>> datavar <<< "+datavar);
	 
	 	 
	 	$.ajax({
	 		type : "POST",
	 		url : sendToNoChargeAckProperty,
	 		contentType: "application/json; charset=UTF-8",
	 		dataType : 'json',
	 		data : datavar,
	 		async : false,
	 		success : function(data2) 
	 		{ 
	 
	 			
	 			 if(data2.serviceResp > 0)
		            {
	 				 if(data2.serviceCode=="PTE"){
	 					
	 					 $('#srnIdExtractProp').val(data2.srn_id)
		 				 $('#extractFrmProp').attr('action', extractUrlProperty);
		 				 $("#extractFrmProp").submit(); 
	 					 
	 				 }
	 				 else
	 				   {
		 			     $('#srnIdNocProp').val(data2.srn_id)
		 				 $('#nocFrmProp').attr('action', nocUrlProperty);
		 				 $("#nocFrmProp").submit(); 
		                }
	 				 
		            }
	 			 else
	 			 {
	 				PNotify.removeAll();
	 				new PNotify({
	 					title : 'Error while saving data.',
	 					styling : 'bootstrap3',
	 					type : 'error'
	 				});	 
	 				 
	 			 }
	 	 
	 	 
	 	
	 		} //success
	 	
	 	
	 	
	 	
	 	}); //properrtyajax
	 	 
	 	 
	 	 
	 	 
	 	 
	  
       }//else
	  
	 } //validation
	
   }); //applFunc

});  //ready Fun
